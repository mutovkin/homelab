apiVersion: 1

# Grafana Datasource Provisioning for Observability Stack
# Automatically configures VictoriaMetrics (metrics) and VictoriaLogs (logs)

datasources:
  # VictoriaMetrics - Time-series metrics database (MetricsQL-enabled)
  - name: VictoriaMetrics
    type: victoriametrics-metrics-datasource            # VictoriaMetrics native datasource plugin
    access: proxy                                       # Grafana backend proxies requests
    url: http://victoriametrics:8428                    # VictoriaMetrics service URL
    isDefault: true                                     # Set as default datasource
    editable: true                                      # Allow editing in UI
    version: 1                                          # Datasource version
    jsonData:
      httpMethod: POST                                  # Use POST for queries (better for large queries)
      timeInterval: 30s                                 # Default scrape interval
    basicAuth: true
    basicAuthUser: ${VM_AUTH_USERNAME}
    secureJsonData:
      basicAuthPassword: ${VM_AUTH_PASSWORD}

  # VictoriaLogs - Log aggregation database
  - name: VictoriaLogs
    type: victoriametrics-logs-datasource               # VictoriaLogs plugin type
    access: proxy                                       # Grafana backend proxies requests
    url: http://victorialogs:9428                       # VictoriaLogs base URL
    isDefault: false                                    # Not the default datasource
    editable: true                                      # Allow editing in UI
    version: 1                                          # Datasource version
    jsonData:
      maxLines: 1000                                    # Max log lines per query (prevents browser overload)
      httpMethod: POST                                  # Use POST for queries
    basicAuth: true
    basicAuthUser: ${VL_AUTH_USERNAME}
    secureJsonData:
      basicAuthPassword: ${VL_AUTH_PASSWORD}
